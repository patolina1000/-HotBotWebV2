<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Assinatura Premiada</title>

  <!-- Fontes -->
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;800;900&display=swap" rel="stylesheet"/>

  <style>
    :root{
      --accent:#ff7a00;        /* laranja brand */
      --accent-2:#ff5e62;      /* coral de apoio */
      --text:#1c1c1c;
      --muted:#6b7280;
      --border:#e5e7eb;        /* cinza sutil */
      --border-card:#f7f7f8;   /* fundo dos cards */
      --chip:#fff7ef;
      --badge-grad: linear-gradient(135deg, var(--accent), var(--accent-2));
      --shadow-1: 0 8px 18px rgba(17,17,17,.04);
      --shadow-2: 0 14px 28px rgba(17,17,17,.06);

      --online-green:#10b154;  /* verde do aro */
      --online-ring:5px;       /* espessura do aro (ajuste aqui) */
    }

    /* Estilos do pop-up inicial */
    .popup {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1000;
        animation: fadeIn 0.5s ease;
    }
    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }
    .popup-content {
        background: white;
        padding: 30px;
        border-radius: 15px;
        max-width: 450px;
        text-align: center;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        transform: scale(0.9);
        animation: scaleIn 0.5s forwards;
        margin-right: 10px;
        margin-left: 10px;  
    }
    @keyframes scaleIn {
        to { transform: scale(1); }
    }
    .hidden {
        display: none;
    }
    .btn-upsell {
        background: linear-gradient(135deg, #ff5e62, #ff914d);
        color: white;
        padding: 20px 40px;
        border-radius: 50px;
        font-size: 22px;
        font-weight: 600;
        display: inline-block;
        text-decoration: none;
        margin: 20px auto;
        box-shadow: 0 10px 30px rgba(255, 94, 98, 0.4);
        transition: all 0.3s ease;
        border: none;
        cursor: pointer;
        text-transform: uppercase;
        letter-spacing: 1px;
        width: 100%;
        max-width: 400px;
    }
    .btn-upsell:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 40px rgba(255, 94, 98, 0.6);
        color: white;
        text-decoration: none;
        background: linear-gradient(135deg, #ff4447, #ff7f3a);
    }
    .btn-upsell:active {
        transform: translateY(-2px);
    }

    *{margin:0;padding:0;box-sizing:border-box}
    body{
      background:#fff;
      color:var(--text);
      font-family:'Montserrat',sans-serif;
      line-height:1.6;
      overflow-x:hidden;
    }
    .container{max-width:1000px;margin:0 auto;padding:20px}
    .img-fluid{max-width:100%;height:auto;display:block}

    /* Logo Privacy (PNG) */
    .brand-cap{
      width:100%;
      margin:0;
      padding:0;
      margin-top:30px;
      text-align:center;
    }
    .brand-cap img{
      height:24px;
      width:auto;
      display:block;
      margin:0 auto;
    }

    /* Aviso importante (texto) */
    .notice-wrap{
      padding:10px 20px 0;
      margin-top: 20px;
      margin-bottom: 30px;
    }
    .notice-card{
      background:var(--border-card);
      border:1px solid var(--accent);
      border-radius:14px;box-shadow:var(--shadow-1);
      padding:20px;text-align:center;
    }
    .notice-card h2{color:#1c1c1c;font-size:22px;font-weight:900;margin-bottom:6px}
    .notice-card p{color:var(--muted);font-size:14px}

    /* Hero */
    .hero{display:flex;flex-direction:column;align-items:center;padding:28px 20px;text-align:center}
    .profile-img-wrapper{
      position:relative;
      display:inline-block;
      margin-top:-60px; /* mover foto mais para cima */
    }
    /* ARO VERDE colado na foto (sem espaço branco) */
    .profile-img{
      width:200px;height:200px;border-radius:50%;
      border:var(--online-ring) solid var(--online-green); /* aro grudado */
      object-fit:cover;
      box-shadow:0 0 10px rgba(16, 177, 84, 0.18);            /* glow leve */
      margin-top: 0;
    }
    .caption{font-size:13px;color:var(--accent);font-weight:800;margin:14px 0 10px;text-transform:uppercase;letter-spacing:.8px}
    .hero-title{font-size:30px;font-weight:900;margin-bottom:12px;color:var(--text);text-wrap:balance}
    .hero-description{font-size:18px;color:var(--muted)}

    /* Divider */
    .divider{height:1px;background:linear-gradient(90deg,transparent,var(--border),transparent);margin:4px 0}

    /* Surfaces (cards) com BORDA LARANJA */
    .surface{
      background:var(--border-card);
      border:1px solid var(--accent);
      border-radius:14px;
      box-shadow:var(--shadow-1);
    }

    /* Benefícios */
    .benefits-section{padding:10px 20px 10px;text-align:center}
    .benefits-title{text-align:center;font-size:20px;margin-bottom:14px;color:var(--text);text-transform:uppercase;letter-spacing:.8px}
    .benefits-list{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:14px;max-width:900px;margin:0 auto}
    .benefit-item{
      padding:16px;border-left:4px solid var(--accent);
      background:#ffffff;border-radius:10px;transition:.2s
    }
    .benefit-item:hover{transform:translateY(-2px);box-shadow:var(--shadow-2)}
    .benefit-icon{color:var(--accent);font-size:20px;margin-bottom:8px}
    .benefit-title{font-weight:900;margin-bottom:4px;font-size:16px;color:var(--text)}
    .benefit-description{font-size:14px;color:var(--muted)}
    .chip{display:inline-block;background:var(--chip);color:#a24a00;font-size:12px;font-weight:800;border:1px solid #ffe3cc;border-radius:999px;padding:6px 10px;margin:0 auto 14px;text-transform:uppercase;letter-spacing:.6px}

    /* Preço */
    .price-section{padding:24px 20px 18px 20px;text-align:center;margin:18px auto 8px;max-width:840px;position:relative}
    .price-badge{
      position:absolute;top:-14px;right:-14px;
      background:var(--badge-grad);
      color:#fff;padding:10px 16px;border-radius:999px;
      font-weight:800;font-size:14px;
      box-shadow:0 10px 24px rgba(255,94,98,.25);
      transform:rotate(12deg); /* >>> giro pro outro lado */
      animation:badge-bounce-tilt 1.6s ease-in-out infinite;
      transform-origin:center;
    }
    @keyframes badge-bounce-tilt{
      0%,100%{transform:rotate(12deg) translateY(0) scale(1)}
      30%{transform:rotate(12deg) translateY(-6px) scale(1.04)}
      60%{transform:rotate(12deg) translateY(0) scale(0.98)}
    }
    .price-section h3{color:var(--text);margin-bottom:6px}
    .old-price{display:block;color:#9b9b9b;text-decoration:line-through;font-size:18px;margin-bottom:6px}
    .new-price{display:block;font-size:40px;font-weight:900;margin-bottom:8px;background:var(--badge-grad);-webkit-background-clip:text;background-clip:text;-webkit-text-fill-color:transparent}
    .price-installment{font-size:15px;color:var(--muted)}

    /* Oferta + Timer */
    .offer-timer{padding:18px 16px;text-align:center;margin:18px auto 8px;max-width:840px}
    .offer-title-small{font-weight:900;font-size:18px;color:var(--text);margin-bottom:6px}
    .timer{display:flex;justify-content:center;gap:12px;margin-top:6px}
    .timer-item{display:flex;flex-direction:column;align-items:center;min-width:72px;border:2px solid rgba(255,122,0,.25);border-radius:10px;padding:8px 10px;background:#fff}
    .timer-number{font-size:22px;font-weight:800;color:var(--accent)}
    .timer-label{font-size:11px;text-transform:uppercase;color:var(--muted)}

    /* CTAs (sem links) */
    .cta-section{text-align:center;padding:8px 20px 32px}
    .btn{display:inline-block;padding:16px 36px;border-radius:999px;text-decoration:none;font-weight:900;font-size:16px;text-transform:uppercase;margin:10px;border:none;cursor:pointer;transition:.22s}
    .btn-primary{background:var(--badge-grad);color:#fff;box-shadow:0 12px 26px rgba(255,94,98,.28),0 4px 10px rgba(0,0,0,.06)}
    .btn-primary:hover{transform:translateY(-2px);box-shadow:0 16px 34px rgba(255,94,98,.4),0 6px 12px rgba(0,0,0,.08)}
    .btn-secondary{background:#fff;color:var(--muted);border:1px solid var(--border)}
    .btn-secondary:hover{background:#fafafa;color:#444}

    /* Footer */
    .footer{text-align:center;padding:18px;color:var(--muted);font-size:13px;border-top:1px solid var(--border);background:#fff;margin-top:8px}

    /* Fade-ins */
    .fade-in{animation:fadeIn .8s ease-in}
    @keyframes fadeIn{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}

    @media (max-width:768px){
      .hero-title{font-size:26px}
      .new-price{font-size:34px}
      .btn{display:block;margin:10px auto;max-width:320px}
      .brand-card img{height:34px}
    }
  </style>
</head>
<body>
    <!-- Pop-up inicial -->
    <div id="popup" class="popup">
        <div class="popup-content">
            <h2>Parabéns!</h2>
            <p>Você foi o homem sortudo nº 1.000 a assinar no Privacy e, por isso, ganhou este brinde exclusivo de Hadrielle Maria.</p>
            <button class="btn-upsell" onclick="revealOffer()">Revelar Meu Presente</button>
        </div>
    </div>

    <!-- Conteúdo principal (inicialmente oculto) -->
    <div id="main-content" class="hidden">

  <!-- Logo Privacy -->
  <div class="brand-cap">
    <img src="assets/logo-black.svg" alt="Privacy Logo">
  </div>

  <!-- Aviso importante -->
  <div class="container notice-wrap">
    <div class="notice-card surface">
      <h2><span style="color:var(--accent)">Aviso importante:</span> não feche esta página!</h2>
      <p>Essa é uma oportunidade única e secreta que não vai aparecer de novo.</p>
    </div>
  </div>

  <!-- HERO -->
  <div class="container">
    <div class="hero fade-in">
      <div class="profile-img-wrapper">
        <img src="assets/perfil.jpg" alt="Stella Beghini" class="profile-img"/>
      </div>
      <div class="hero-content">
        <span class="caption">Mensagem exclusiva para você</span>
        <h2 class="hero-title">Acabei de preparar algo proibido, feito sob medida e 100% personalizado só pra você</h2>
        <p class="hero-description">
          Vou gravar até <strong style="color:var(--accent)">10 minutos</strong> de putaria explícita,
          falando e gemendo <strong style="color:var(--accent)">seu nome</strong>, abrindo meu corpo como você mandar,
          sem frescura, sem censura, pedindo pra você me comer bem gostoso.
        </p>
      </div>
    </div>

    <div class="divider"></div>

    <!-- BENEFÍCIOS -->
    <section class="benefits-section fade-in">
      <div class="chip" style="text-align:center;">o que você vai receber agora</div>
      <div class="benefits-list">
        <div class="benefit-item surface">
          <div class="benefit-icon">✔️</div>
          <div class="benefit-title">Seu nome na minha pele</div>
          <div class="benefit-description">Eu marco seu nome onde você mandar, pra ficar gravado quem manda em mim.</div>
        </div>
        <div class="benefit-item surface">
          <div class="benefit-icon">✔️</div>
          <div class="benefit-title">Comando e obediência</div>
          <div class="benefit-description">Provoco com a bucetinha até ver sua pica gozar litros de porra sem parar.</div>
        </div>
        <div class="benefit-item surface">
          <div class="benefit-icon">✔️</div>
          <div class="benefit-title">Fantasias e fetiches liberados</div>
          <div class="benefit-description">Eu entro no seu jogo e deixo o cuzinho empinado onde quiser.</div>
        </div>
        <div class="benefit-item surface">
          <div class="benefit-icon">✔️</div>
          <div class="benefit-title">Entrega sigilosa</div>
          <div class="benefit-description">Entrega 100% privada, com sua assinatura inclusa.</div>
        </div>
        <div class="benefit-item surface">
          <div class="benefit-icon">✔️</div>
          <div class="benefit-title">Bônus exclusivo</div>
          <div class="benefit-description">Meu WhatsApp pessoal para marcar encontros presenciais.</div>
        </div>
      </div>
    </section>

    <div class="divider"></div>

    <!-- PREÇO (selo inclinado pro lado certo) -->
    <div class="price-section surface fade-in">
      <div class="price-badge">88% OFF HOJE!</div>
      <h3>Por tempo limitado, acesse tudo por apenas:</h3>
      <span class="old-price">De R$ 147,00</span>
      <span class="new-price">Por R$ 17,00</span>
      <p class="price-installment">Esta oferta expira em:</p>
      <div class="timer">
        <div class="timer-item">
          <span class="timer-number" id="minutes">05</span>
          <span class="timer-label">min</span>
        </div>
        <div class="timer-item">
          <span class="timer-number" id="seconds">00</span>
          <span class="timer-label">seg</span>
        </div>
      </div>
    </div>

    <!-- CTAs (href vazio p/ sua API de PIX) -->
    <div class="cta-section fade-in">
      <a href="#" class="btn btn-primary" onclick="gerarPixPlano('assinatura_premiada', 'Vídeo Personalizado', 17.00); return false;">GARANTIR MEU VÍDEO PERSONALIZADO</a>
      <a href="chamada_premiada.html" class="btn btn-secondary">Não, sou frouxo</a>
    </div>

    <!-- Footer -->
    <div class="footer">
      <p>© 2025 Todos os direitos reservados.</p>
    </div>
  </div>

    </div> <!-- Fim do conteúdo principal -->

  <!-- SweetAlert2 para modal PIX -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <script>
    // Função para revelar a oferta (esconder pop-up e mostrar conteúdo principal)
    function revealOffer() {
        document.getElementById('popup').classList.add('hidden');
        document.getElementById('main-content').classList.remove('hidden');
        // Iniciar o timer quando a oferta for revelada
        startTimer(5*60);
    }

    // Timer (05:00 -> 00:00)
    function startTimer(totalSeconds){
      let t = totalSeconds;
      const minEl = document.getElementById('minutes');
      const secEl = document.getElementById('seconds');
      const iv = setInterval(()=>{
        const m = String(Math.floor(t/60)).padStart(2,'0');
        const s = String(t%60).padStart(2,'0');
        minEl.textContent = m;
        secEl.textContent = s;
        if(t<=0){ clearInterval(iv); }
        t--;
      },1000);
    }
    // Timer não inicia automaticamente - só quando o pop-up for fechado

    // Fade-in on scroll
    document.addEventListener('DOMContentLoaded', function() {
      const fadeElements = document.querySelectorAll('.fade-in');
      const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            entry.target.style.opacity = 1;
            entry.target.style.transform = 'translateY(0)';
          }
        });
      }, { threshold: 0.1 });

      fadeElements.forEach(el=>{
        el.style.opacity=0;
        el.style.transform='translateY(12px)';
        el.style.transition='opacity .8s ease, transform .8s ease';
        observer.observe(el);
      });
    });

    // ===== SISTEMA PIX COMPLETO =====
    
    // Variáveis de polling
    let pollingInterval = null;
    let pollingAttempts = 0;
    const maxPollingAttempts = 120; // 10 minutos (5s * 120)
    
    // Função para gerar PIX e mostrar pop-up
    async function gerarPixPlano(planoId, planoNome, planoValor) {
        try {
            console.log(`[ASSINATURA-PREMIADA] Iniciando geração de PIX para: ${planoNome} - R$ ${planoValor}`);
            
            // Mostrar loading
            Swal.fire({
                title: 'Gerando PIX...',
                text: 'Aguarde um momento',
                allowOutsideClick: false,
                didOpen: () => {
                    Swal.showLoading()
                }
            });

            // 🎯 Capturar click_id do Kwai antes de enviar
            const kwaiClickId = window.KwaiTracker?.getClickId() || 
                               window.KwaiClickTracker?.getClickId() || 
                               localStorage.getItem('kwai_click_id') || 
                               null;
            
            console.log('🎯 [ASSINATURA-PREMIADA] Click ID capturado para envio:', kwaiClickId ? kwaiClickId.substring(0, 20) + '...' : 'não encontrado');

            const response = await fetch('/api/gerar-pix-checkout', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    plano_id: planoId,
                    valor: planoValor,
                    kwai_click_id: kwaiClickId
                })
            });

            const data = await response.json();

            if (data.success && data.qr_code_base64 && data.pix_copia_cola) {
                // Fechar loading
                Swal.close();

                // Coletar dados visuais já disponíveis na página
                const coverSrc = 'assets/banner.jpg';
                const avatarSrc = 'assets/perfil.jpg';
                const nomePerfil = 'Hadrielle Maria';
                const handlePerfil = '@hadrielle_maria';

                // 🎯 NOVO: Iniciar polling para verificar status do pagamento
                function startPaymentPolling(transactionId) {
                    console.log(`[ASSINATURA-PREMIADA] 🔄 Iniciando polling para transação: ${transactionId}`);
                    
                    // Função async para verificar pagamento
                    const checkPayment = async () => {
                        pollingAttempts++;
                        console.log(`[ASSINATURA-PREMIADA] 🔍 Verificando pagamento (tentativa ${pollingAttempts}/${maxPollingAttempts})`);
                        
                        try {
                            const response = await fetch(`https://ohvips.xyz/api/payment-status/${transactionId}`, { 
                                method: 'GET',
                                headers: {
                                    'Accept': 'application/json',
                                    'Content-Type': 'application/json'
                                }
                            });
                            
                            if (!response.ok) {
                                console.error(`[ASSINATURA-PREMIADA] ❌ Status endpoint retornou erro:`, response.status, response.statusText);
                                return;
                            }
                            
                            const statusData = await response.json();
                            
                            if (statusData.success && statusData.is_paid) {
                                console.log(`[ASSINATURA-PREMIADA] ✅ Pagamento confirmado! Redirecionando...`);
                                
                                // 🔥 DISPARAR EVENTO PURCHASE DEDUPLICADO
                                if (window.CheckoutTracking && typeof window.CheckoutTracking.trackPurchase === 'function') {
                                    const transactionId = statusData.transaction_id || data.transaction_id || `assinatura_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
                                    console.log(`[ASSINATURA-PREMIADA] 🎯 Disparando Purchase para transaction_id: ${transactionId}`);
                                    window.CheckoutTracking.trackPurchase(transactionId);
                                } else if (window.PurchaseTracking && typeof window.PurchaseTracking.sendPurchase === 'function') {
                                    const transactionId = statusData.transaction_id || data.transaction_id || `assinatura_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
                                    console.log(`[ASSINATURA-PREMIADA] 🎯 Disparando Purchase via PurchaseTracking para transaction_id: ${transactionId}, valor: ${planoValor}`);
                                    window.PurchaseTracking.sendPurchase(transactionId, planoValor, 'BRL', planoNome);
                                } else {
                                    console.warn('[ASSINATURA-PREMIADA] ⚠️ Sistema de Purchase tracking não disponível');
                                }
                                
                                // Parar o polling
                                if (pollingInterval) {
                                    clearInterval(pollingInterval);
                                    pollingInterval = null;
                                }
                                
                                // Fechar modal e redirecionar
                                Swal.close();
                                
                                // Mostrar mensagem de sucesso e redirecionar
                                await Swal.fire({
                                    icon: 'success',
                                    title: 'Pagamento Confirmado!',
                                    text: 'Redirecionando...',
                                    showConfirmButton: false,
                                    timer: 2000,
                                    timerProgressBar: true
                                });
                                
                                // Redirecionar para chamada premiada
                                window.location.href = 'chamada_premiada.html';
                                
                                return;
                            }
                            
                            // Verificar se a transação expirou
                            if (statusData.expired) {
                                console.log(`[ASSINATURA-PREMIADA] ⏰ Transação expirada (${statusData.age_minutes} min), parando polling`);
                                
                                // Parar o polling
                                if (pollingInterval) {
                                    clearInterval(pollingInterval);
                                    pollingInterval = null;
                                }
                                
                                // Mostrar mensagem de expiração
                                Swal.fire({
                                    icon: 'warning',
                                    title: 'Tempo Esgotado',
                                    text: 'O tempo para pagamento expirou. Por favor, gere um novo PIX.',
                                    confirmButtonText: 'Gerar Novo PIX',
                                    showCancelButton: true,
                                    cancelButtonText: 'Fechar'
                                }).then((result) => {
                                    if (result.isConfirmed) {
                                        // Recarregar a página para gerar novo PIX
                                        window.location.reload();
                                    } else {
                                        // Fechar modal
                                        Swal.close();
                                    }
                                });
                                
                                return;
                            }
                            
                            // Se atingiu o limite de tentativas, parar o polling
                            if (pollingAttempts >= maxPollingAttempts) {
                                console.log(`[ASSINATURA-PREMIADA] ⏰ Timeout do polling após ${maxPollingAttempts} tentativas`);
                                if (pollingInterval) {
                                    clearInterval(pollingInterval);
                                    pollingInterval = null;
                                }
                                return;
                            }
                        } catch (error) {
                            console.error(`[ASSINATURA-PREMIADA] ❌ Erro ao verificar pagamento:`, error);
                        }
                    };
                    
                    // Iniciar polling a cada 5 segundos
                    pollingInterval = setInterval(checkPayment, 5000);
                    
                    // Primeira verificação imediata
                    checkPayment();
                }

                // Modal moderna mantendo a mesma lógica de funcionamento
                Swal.fire({
                    title: '',
                    html: `
                        <div class="pix-modal" style="text-align:left; font-family: inherit; color:#222; margin: -30px; border-radius: 16px; overflow: hidden; height: 100%; display: flex; flex-direction: column;">
                            <div class="pix-cover" style="position: relative; overflow:hidden; width:100%; border-top-left-radius:16px; border-top-right-radius:16px; margin: 0; padding: 0;">
                                <img src="${coverSrc}" alt="capa" style="width: 100%; height: 108px; object-fit: cover; display:block;">
                                <button type="button" class="pix-close" aria-label="Fechar" style="position:absolute; top:12px; right:12px; z-index:3; width:34px; height:34px; border:none; border-radius:50%; background:#ffffff; color:#6B7280; display:flex; align-items:center; justify-content:center; box-shadow:0 4px 12px rgba(0,0,0,.12); cursor:pointer;">
                                    ×
                                </button>
                                <div class="pix-avatar" style="position:absolute; left:16px; bottom:10px; z-index:2; width:55px; height:55px; border-radius:50%; overflow:hidden; border:3px solid #00ff88; box-shadow: 0 0 15px rgba(0, 255, 136, 0.7); animation: pulse-online 2s infinite;">
                                    <img src="${avatarSrc}" alt="avatar" style="width:100%; height:100%; object-fit:cover; display:block;">
                                </div>
                                <div class="pix-identity" style="position:absolute; left:85px; bottom:22px; z-index:2; color:#fff; text-shadow:0 1px 2px rgba(0,0,0,.25);">
                                    <div style="font-weight:700; font-size:18px; line-height:1.2;">${nomePerfil}</div>
                                    <div style="font-size:12px; color:#e5e7eb;">${handlePerfil}</div>
                                </div>
                            </div>

                            <div class="pix-content-scroll" style="flex: 1; overflow-y: auto; overflow-x: hidden;">
                            <div style="padding: 18px 50px 0 50px;">
                                <div style="font-weight:600; margin: 0 0 10px 0; font-size:16px; color:#222; text-align:left;">Benefícios Exclusivos</div>
                                <div style="display:flex; flex-direction:column; gap:8px; color:#374151; text-align:left;">
                                    <div style="display:flex; gap:10px; align-items:flex-start; justify-content:flex-start;">
                                        <span style="color:#ef4444; font-size:14px; line-height:1;">✔</span>
                                        <span style="font-size:14px;">Vídeo personalizado de 10 minutos</span>
                                    </div>
                                    <div style="display:flex; gap:10px; align-items:flex-start; justify-content:flex-start;">
                                        <span style="color:#ef4444; font-size:14px; line-height:1;">✔</span>
                                        <span style="font-size:14px;">Seu nome falado no vídeo</span>
                                    </div>
                                    <div style="display:flex; gap:10px; align-items:flex-start; justify-content:flex-start;">
                                        <span style="color:#ef4444; font-size:14px; line-height:1;">✔</span>
                                        <span style="font-size:14px;">Entrega sigilosa e privada</span>
                                    </div>
                                </div>
                            </div>

                            <div style="padding: 18px 50px 0 50px;">
                                <div style="background:#F3F4F6; border-radius:16px; box-shadow: 0 6px 16px rgba(0,0,0,.06); padding:20px;">
                                    <div style="font-weight:600; color:#222; margin-bottom:10px;">Plano: ${planoNome}</div>
                                    <div style="color:#6B7280; font-size:13px;">Valor</div>
                                    <div style="margin-top:6px; font-weight:700; font-size:20px; color:#111827;">R$ ${planoValor.toFixed(2)}</div>
                                </div>
                            </div>

                            <div style="padding: 18px 50px 0 50px;">
                                <div style="background:#F3F4F6; border-radius:16px; box-shadow: 0 6px 16px rgba(0,0,0,.06); padding:24px; display:flex; align-items:center; justify-content:center;">
                                    <img src="${data.qr_code_base64}" alt="QR Code PIX" style="width: 256px; height: 256px; max-width: 100%; object-fit: contain;">
                                </div>
                            </div>

                            <div style="padding: 18px 50px 0 50px;">
                                <div style="font-weight:700; color:#6B7280; font-size:12px; letter-spacing:.24px;">CHAVE PIX</div>
                                <div style="position: relative; margin-top:10px;">
                                    <div style="background:#fff; border:1px solid #e5e7eb; border-radius:14px; padding:12px 36px 12px 12px; font-family: monospace; font-size:12px; color:#111827; white-space: nowrap; overflow-x: auto; box-shadow: 0 2px 6px rgba(0,0,0,.04);">${data.pix_copia_cola}</div>
                                    <div style="position:absolute; right:10px; top:50%; transform: translateY(-50%); color:#9CA3AF; font-size:16px; user-select:none;">›</div>
                                </div>
                            </div>

                            <div style="padding: 8px 50px 50px 50px;">
                                <button id="copiar-pix" onclick="copiarPixCola('${data.pix_copia_cola}')" style="width:100%; border:none; border-radius:16px; padding: 14px 16px; color:#fff; font-weight:800; letter-spacing:.2px; cursor:pointer; background: linear-gradient(90deg,#ff8a5c,#ffb199); box-shadow: 0 10px 18px rgba(255,138,92,.35); text-transform: uppercase;">
                                    COPIAR CHAVE PIX
                                </button>
                            </div>
                            </div>
                        </div>
                    `,
                    showCloseButton: false,
                    showConfirmButton: false,
                    width: window.innerWidth <= 768 ? '95vw' : '480px',
                    backdrop: false,
                    allowOutsideClick: false,
                    allowEscapeKey: true,
                    didOpen: () => {
                        const popup = Swal.getPopup();
                        if (popup) {
                            popup.style.padding = '0';
                            popup.style.borderRadius = '16px';
                            popup.style.overflow = 'hidden';
                            popup.style.width = window.innerWidth <= 768 ? '95vw' : '480px';
                            popup.style.height = 'calc(100vh - 80px)';
                            popup.style.maxHeight = 'calc(100vh - 80px)';
                            popup.style.maxWidth = window.innerWidth <= 768 ? '95vw' : '480px';
                            popup.style.minWidth = window.innerWidth <= 768 ? '95vw' : '480px';
                            popup.style.boxShadow = '0 12px 32px rgba(0,0,0,.12)';
                            popup.style.position = 'fixed';
                            popup.style.top = '50%';
                            popup.style.left = '50%';
                            popup.style.transform = 'translate(-50%, -50%)';
                            popup.style.margin = '0';
                            popup.style.pointerEvents = 'auto';
                            popup.style.touchAction = 'pan-y';
                            popup.style.userSelect = 'none';
                            popup.style.webkitUserDrag = 'none';
                            popup.style.userDrag = 'none';
                        }
                        
                        // 🎯 NOVO: Iniciar polling após modal abrir
                        console.log(`[ASSINATURA-PREMIADA] 🚀 Iniciando polling para transação: ${data.transacao_id}`);
                        startPaymentPolling(data.transacao_id);
                        
                        // Backdrop custom
                        const existing = document.querySelector('.modal-backdrop');
                        if (!existing) {
                            const backdrop = document.createElement('div');
                            backdrop.className = 'modal-backdrop';
                            backdrop.style.position = 'fixed';
                            backdrop.style.inset = '0';
                            backdrop.style.background = 'rgba(0,0,0,.40)';
                            backdrop.style.zIndex = '900';
                            document.body.appendChild(backdrop);
                            backdrop.addEventListener('click', () => Swal.close());
                        }
                        
                        // Z-index do modal acima do backdrop
                        const container = Swal.getContainer();
                        if (container) {
                            container.style.zIndex = '1000';
                            container.style.padding = '0 20px 40px 20px';
                            container.style.margin = '0';
                            container.style.display = 'flex';
                            container.style.alignItems = 'center';
                            container.style.justifyContent = 'center';
                            container.style.minHeight = '100vh';
                        }
                        
                        // Event listener para botão de fechar
                        const closeBtn = popup.querySelector('.pix-close');
                        if (closeBtn) {
                            closeBtn.addEventListener('click', () => {
                                // Parar polling se estiver ativo
                                if (pollingInterval) {
                                    clearInterval(pollingInterval);
                                    pollingInterval = null;
                                }
                                
                                // Remover backdrop customizado
                                const backdrop = document.querySelector('.modal-backdrop');
                                if (backdrop) {
                                    backdrop.remove();
                                }
                                
                                Swal.close();
                            });
                        }
                    }
                });

            } else {
                throw new Error(data.error || 'Erro ao gerar PIX');
            }

        } catch (error) {
            console.error('[ASSINATURA-PREMIADA] Erro ao gerar PIX:', error);
            Swal.fire({
                icon: 'error',
                title: 'Erro',
                text: 'Não foi possível gerar o PIX. Tente novamente.',
                confirmButtonText: 'Tentar Novamente'
            });
        }
    }

    // Função para copiar chave PIX
    window.copiarPixCola = function(codigo) {
        navigator.clipboard.writeText(codigo).then(() => {
            // Mostrar feedback visual sem fechar o modal principal
            const button = document.getElementById('copiar-pix');
            if (button) {
                const originalText = button.textContent;
                button.textContent = '✓ COPIADO!';
                button.style.background = 'linear-gradient(90deg,#10b981,#34d399)';
                
                // Restaurar botão após 2 segundos
                setTimeout(() => {
                    button.textContent = originalText;
                    button.style.background = 'linear-gradient(90deg,#ff8a5c,#ffb199)';
                }, 2000);
            }
        }).catch(() => {
            // Fallback para navegadores mais antigos
            const textArea = document.createElement('textarea');
            textArea.value = codigo;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);
            
            // Mostrar feedback visual sem fechar o modal principal
            const button = document.getElementById('copiar-pix');
            if (button) {
                const originalText = button.textContent;
                button.textContent = '✓ COPIADO!';
                button.style.background = 'linear-gradient(90deg,#10b981,#34d399)';
                
                // Restaurar botão após 2 segundos
                setTimeout(() => {
                    button.textContent = originalText;
                    button.style.background = 'linear-gradient(90deg,#ff8a5c,#ffb199)';
                }, 2000);
            }
        });
    };

    // ===== FIM SISTEMA PIX =====
    
    // Listener global para limpar backdrop quando SweetAlert2 fechar
    document.addEventListener('click', function(e) {
        if (e.target.classList.contains('swal2-backdrop') || e.target.classList.contains('modal-backdrop')) {
            const backdrop = document.querySelector('.modal-backdrop');
            if (backdrop) {
                backdrop.remove();
            }
        }
    });
    
    // Listener para tecla ESC
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            const backdrop = document.querySelector('.modal-backdrop');
            if (backdrop) {
                backdrop.remove();
            }
        }
    });
  </script>
</body>
</html>
