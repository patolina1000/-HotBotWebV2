<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Preparando seu acesso...</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <!-- üî• NOVO: Sistema de Tracking do Kwai -->
  <script src="/js/kwai-click-tracker.js"></script>
  
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f8fafc;
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100vh;
      margin: 0;
    }
    .container {
      background: white;
      border-radius: 12px;
      padding: 30px;
      text-align: center;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      max-width: 350px;
      width: 100%;
    }
    .container img {
      width: 140px;
      height: 140px;
      border-radius: 8px;
      margin-bottom: 20px;
      object-fit: cover;
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    .container img.loaded {
      opacity: 1;
    }
    .image-placeholder {
      width: 140px;
      height: 140px;
      border-radius: 8px;
      margin-bottom: 20px;
      background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      color: #9ca3af;
      font-size: 12px;
      text-align: center;
      padding: 10px;
      box-sizing: border-box;
    }
    h2 {
      font-size: 20px;
      color: #111827;
      margin-bottom: 8px;
    }
    p {
      font-size: 14px;
      color: #4b5563;
      margin-bottom: 20px;
    }
    .progress-bar {
      width: 100%;
      height: 6px;
      background: #e5e7eb;
      border-radius: 6px;
      overflow: hidden;
    }
    .progress {
      height: 100%;
      width: 0%;
      background: #2563eb;
      animation: load 3s forwards;
    }
    @keyframes load {
      from { width: 0%; }
      to { width: 100%; }
    }
    footer {
      margin-top: 16px;
      font-size: 12px;
      color: #6b7280;
    }
    .debug-info {
      font-size: 10px;
      color: #9ca3af;
      margin-top: 10px;
      padding: 5px;
      background: #f3f4f6;
      border-radius: 4px;
    }
    .loading-indicator {
      display: inline-block;
      width: 16px;
      height: 16px;
      border: 2px solid #e5e7eb;
      border-top: 2px solid #2563eb;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    /* üî• NOVO: Status do tracking */
    .tracking-status {
      font-size: 11px; color: #666; margin-top: 10px; padding: 5px;
      background: #f8f9fa; border-radius: 4px; border: 1px solid #e9ecef;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="image-placeholder" id="imagePlaceholder">
      Carregando imagem...
    </div>
    <img id="avatar" src="/redirect/images/hadrielle.jpg" alt="Hadrielle Maria" style="display: none;">
    
    <h2>Preparando seu acesso...</h2>
    <p>Aguarde enquanto preparamos tudo para voc√™...</p>
    
    <div class="progress-bar">
      <div class="progress"></div>
    </div>
    
    <!-- üî• NOVO: Status do tracking -->
    <div class="tracking-status" id="trackingStatus">
      üîç Verificando tracking...
    </div>
    
    <footer>
      <div class="debug-info" id="debugInfo">
        Carregando informa√ß√µes...
      </div>
    </footer>
  </div>

  <!-- üî• NOVO: Script de tracking autom√°tico -->
  <script>
    // Fun√ß√£o para enviar evento de visualiza√ß√£o de conte√∫do
    async function sendContentViewEvent() {
      try {
        // Aguardar o sistema de tracking carregar
        if (typeof window.KwaiTracker === 'undefined') {
          console.log('‚è≥ Aguardando sistema de tracking carregar...');
          setTimeout(sendContentViewEvent, 1000);
          return;
        }

        console.log('üéØ [REDIRECT] Enviando evento EVENT_CONTENT_VIEW...');
        
        // Enviar evento de visualiza√ß√£o de conte√∫do
        const result = await window.KwaiTracker.sendContentView({
          content_id: 'privacy_redirect_page',
          content_name: 'Privacy - P√°gina de Redirecionamento',
          content_category: 'Privacy'
        });

        if (result.success) {
          console.log('‚úÖ [REDIRECT] Evento EVENT_CONTENT_VIEW enviado com sucesso');
          document.getElementById('trackingStatus').innerHTML = 
            '‚úÖ Tracking: Evento de visualiza√ß√£o enviado para Kwai';
        } else {
          console.warn('‚ö†Ô∏è [REDIRECT] Falha ao enviar evento:', result.reason || result.error);
          document.getElementById('trackingStatus').innerHTML = 
            '‚ö†Ô∏è Tracking: Falha ao enviar evento - ' + (result.reason || result.error);
        }

      } catch (error) {
        console.error('‚ùå [REDIRECT] Erro ao enviar evento:', error);
        document.getElementById('trackingStatus').innerHTML = 
          '‚ùå Tracking: Erro - ' + error.message;
      }
    }

    // Fun√ß√£o para verificar status do tracking
    function checkTrackingStatus() {
      const statusElement = document.getElementById('trackingStatus');
      
      if (typeof window.KwaiTracker === 'undefined') {
        statusElement.innerHTML = '‚è≥ Aguardando sistema de tracking...';
        return;
      }

      const hasClickId = window.KwaiTracker.hasValidClickId();
      const clickId = window.KwaiTracker.getClickId();

      if (hasClickId && clickId) {
        statusElement.innerHTML = 
          '‚úÖ Tracking: Click ID v√°lido - ' + clickId.substring(0, 10) + '...';
        
        // Enviar evento de visualiza√ß√£o ap√≥s 1 segundo
        setTimeout(sendContentViewEvent, 1000);
      } else {
        statusElement.innerHTML = '‚ö†Ô∏è Tracking: Nenhum Click ID v√°lido encontrado';
      }
    }

    // Fun√ß√£o para carregar imagem
    function loadImage() {
      const img = document.getElementById('avatar');
      const placeholder = document.getElementById('imagePlaceholder');
      
      img.onload = function() {
        placeholder.style.display = 'none';
        img.style.display = 'block';
        img.classList.add('loaded');
      };
      
      img.onerror = function() {
        placeholder.innerHTML = '‚ùå Erro ao carregar imagem';
        placeholder.style.color = '#dc2626';
      };
    }

    // Fun√ß√£o para mostrar informa√ß√µes de debug
    function showDebugInfo() {
      const debugElement = document.getElementById('debugInfo');
      
      if (typeof window.KwaiTracker === 'undefined') {
        debugElement.innerHTML = 'KwaiTracker: N√£o carregado';
        return;
      }

      const hasClickId = window.KwaiTracker.hasValidClickId();
      const clickId = window.KwaiTracker.getClickId();
      
      debugElement.innerHTML = `
        KwaiTracker: ${hasClickId ? '‚úÖ Ativo' : '‚ùå Inativo'}<br>
        Click ID: ${clickId ? clickId.substring(0, 10) + '...' : 'Nenhum'}<br>
        URL: ${window.location.href.substring(0, 50)}...
      `;
    }

    // Inicializa√ß√£o quando a p√°gina carregar
    document.addEventListener('DOMContentLoaded', () => {
      console.log('üéØ [REDIRECT] P√°gina carregada, inicializando...');
      
      // Carregar imagem
      loadImage();
      
      // Verificar status do tracking
      checkTrackingStatus();
      
      // Mostrar informa√ß√µes de debug
      showDebugInfo();
      
      // Verificar novamente ap√≥s 3 segundos (caso o tracking carregue depois)
      setTimeout(() => {
        checkTrackingStatus();
        showDebugInfo();
      }, 3000);
      
      // Redirecionar ap√≥s 5 segundos
      setTimeout(() => {
        console.log('üîÑ [REDIRECT] Redirecionando para p√°gina principal...');
        window.location.href = '/';
      }, 5000);
    });

    // Log de erros
    window.addEventListener('error', (event) => {
      console.error('‚ùå [REDIRECT] Erro JavaScript:', event.message);
    });

    window.addEventListener('unhandledrejection', (event) => {
      console.error('‚ùå [REDIRECT] Promise rejeitada:', event.reason);
    });
  </script>
</body>
</html>
