<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Preparando acesso VIPâ€¦</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="/telegram/styles.css" />

    <!-- Meta Pixel Code -->
    <noscript>
      <img
        height="1"
        width="1"
        style="display: none"
        src="https://www.facebook.com/tr?id=YOUR_PIXEL_ID&ev=PageView&noscript=1"
        alt=""
      />
    </noscript>
    <script>
      (function (window, document) {
        if (window.__fbPixelConfigPromise) {
          return;
        }

        window.__FB_PIXEL_ID__ = window.__FB_PIXEL_ID__ || null;
        window.__FB_PIXEL_TOKEN__ = window.__FB_PIXEL_TOKEN__ || null;

        let isResolved = false;
        let resolvePromiseCallback = () => {};
        const resolveOnce = (value) => {
          if (isResolved) {
            return;
          }

          isResolved = true;
          resolvePromiseCallback(value);
        };

        const loadConfig = () => {
          if (typeof fetch !== 'function') {
            console.warn('Fetch API indisponÃ­vel: configuraÃ§Ã£o do Meta Pixel nÃ£o carregada.');
            resolveOnce(null);
            return;
          }

          fetch('/api/config', { credentials: 'same-origin' })
            .then((response) => (response.ok ? response.json() : null))
            .then((config) => {
              if (config && config.FB_PIXEL_ID) {
                try {
                  const initOptions = { autoConfig: false };
                  fbq('init', config.FB_PIXEL_ID, {}, initOptions);
                  window.__FB_PIXEL_ID__ = config.FB_PIXEL_ID;

                  if (config.FB_PIXEL_TOKEN) {
                    window.__FB_PIXEL_TOKEN__ = config.FB_PIXEL_TOKEN;
                  }

                  resolveOnce(config);
                  return;
                } catch (error) {
                  console.warn('NÃ£o foi possÃ­vel inicializar o Meta Pixel.', error);
                  resolveOnce(null);
                  return;
                }
              }

              console.warn('Meta Pixel ID nÃ£o configurado no servidor.');
              resolveOnce(config);
            })
            .catch((error) => {
              console.warn('NÃ£o foi possÃ­vel carregar a configuraÃ§Ã£o do Meta Pixel.', error);
              resolveOnce(null);
            });
        };

        window.__fbPixelConfigPromise = new Promise((resolve) => {
          resolvePromiseCallback = resolve;

          const initialize = () => {
            try {
              loadConfig();
            } catch (error) {
              console.warn('Erro inesperado ao configurar o Meta Pixel.', error);
              resolveOnce(null);
            }
          };

          if (window.fbq && typeof window.fbq === 'function') {
            initialize();
            return;
          }

          !(function (f, b, e, v, n, t, s) {
            if (f.fbq) {
              initialize();
              return;
            }
            n = f.fbq = function () {
              n.callMethod ? n.callMethod.apply(n, arguments) : n.queue.push(arguments);
            };
            if (!f._fbq) f._fbq = n;
            n.push = n;
            n.loaded = !0;
            n.version = '2.0';
            n.queue = [];
            t = b.createElement(e);
            t.async = !0;
            t.src = v;
            t.onload = initialize;
            t.onerror = function (error) {
              console.warn('NÃ£o foi possÃ­vel carregar o script do Meta Pixel.', error);
              resolveOnce(null);
            };
            s = b.getElementsByTagName(e)[0];
            s.parentNode.insertBefore(t, s);
          })(window, document, 'script', 'https://connect.facebook.net/en_US/fbevents.js');
        });
      })(window, document);
    </script>
    <!-- End Meta Pixel Code -->
  </head>
  <body>
    <div class="page-wrapper">
      <article class="vip-card" aria-live="polite">
        <header class="header">
          <img
            src="../assets/icon-2.png"
            alt="Telegram"
            class="telegram-logo"
          />
          <img
            src="../assets/imagem.jpg"
            alt="Avatar"
            class="avatar"
          />
        </header>

        <div class="status-line" aria-live="polite">
          <span class="status-dot" aria-hidden="true"></span>
          <span class="status-text">ONLINE AGORA</span>
          <span class="status-separator">Â·</span>
          <span class="status-location">
            <img
              src="../assets/157354.svg"
              alt=""
              class="status-location-icon"
              aria-hidden="true"
            />
            <span id="city" class="status-city">Detectando...</span>
          </span>
        </div>

        <h1 class="title">
          Estamos preparando seu <span>acesso VIPâ€¦</span>
        </h1>

        <p class="subtitle">
          Aguarde alguns segundos enquanto configuramos seu acesso exclusivo.
        </p>

        <div class="info">
          <span>ðŸ”¥ 92% das vagas jÃ¡ foram</span>
          <span>preenchidas</span>
        </div>

        <div class="progress" aria-hidden="true">
          <div class="bar" id="progress-bar"></div>
        </div>

        <p id="countdown" class="countdown">Redirecionando em 4 segundos...</p>
      </article>
    </div>

    <script>
      window.BOT1_LINK_FROM_SERVER = "<%= process.env.BOT1_TELEGRAM_LINK || 'https://t.me/bot1' %>";
    </script>
    <script src="/telegram/fbclid-handler.js" defer></script>
    <script src="/telegram/utmify.js" defer></script>
    <script src="/telegram/utmify-pixel-interceptor.js" defer></script>
    <script src="/telegram/geolocation.js" defer></script>
    <script src="/telegram/app.js" defer></script>
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        const infoElement = document.querySelector('.info');
        if (!infoElement) return;

        const lines = infoElement.querySelectorAll('span');
        if (lines.length < 2) return;

        const messages = [
          ['ðŸ”¥ 92% das vagas jÃ¡ foram', 'preenchidas'],
          ['âœ… 3.948 pessoas acessaram', 'nas Ãºltimas 24h'],
          ['ðŸ”¥ Restam apenas 37 acessos', 'gratuitos']
        ];

        let currentIndex = 0;
        const fadeDuration = 320;

        const applyMessage = (index) => {
          const [lineOne, lineTwo] = messages[index];
          lines[0].textContent = lineOne;
          lines[1].textContent = lineTwo;
        };

        const getStableDelay = () => 2000;

        const scheduleSingleChange = (delay) => {
          window.setTimeout(() => {
            infoElement.classList.add('is-fading');

            window.setTimeout(() => {
              currentIndex = (currentIndex + 1) % messages.length;
              applyMessage(currentIndex);

              window.requestAnimationFrame(() => {
                infoElement.classList.remove('is-fading');
              });
            }, fadeDuration);
          }, delay);
        };

        applyMessage(currentIndex);
        scheduleSingleChange(getStableDelay());
      });
    </script>
  </body>
</html>
