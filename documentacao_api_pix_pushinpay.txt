DOCUMENTAÇÃO API PIX - PUSHINPAY
=====================================

CRIAR PIX
=========

Endpoint: POST /api/pix/cashIn
Base URL Produção: https://api.pushinpay.com.br
Base URL Sandbox: https://api-sandbox.pushinpay.com.br

DESCRIÇÃO:
Este endpoint cria um código PIX para pagamento.

PONTOS DE ATENÇÃO:
------------------
1. Tenha sua conta CRIADA e APROVADA
2. Caso não tenha conta, realizar cadastro em: https://app.pushinpay.com.br/register
3. Para ambiente SANDBOX: fazer cadastro primeiro no ambiente de produção e depois solicitar liberação do SANDBOX no suporte
4. Valores sempre em CENTAVOS
5. Valor mínimo de 50 centavos
6. Checar o limite de valor máximo em sua conta
7. Caso não tenha servidor para receber notificações, não preencher o campo webhook_url

OBRIGATORIEDADE DE AVISO SOBRE O PAPEL DA PUSHIN PAY:
----------------------------------------------------
Item 4.10 dos Termos de Uso: https://pushinpay.com.br/termos-de-uso

É de responsabilidade do usuário da plataforma PUSHIN PAY informar de maneira clara, destacada e acessível em seus canais de venda (sites, redes sociais, aplicativos, plataformas, entre outros), que:

"A PUSHIN PAY atua exclusivamente como processadora de pagamentos e não possui qualquer responsabilidade pela entrega, suporte, conteúdo, qualidade ou cumprimento das obrigações relacionadas aos produtos ou serviços oferecidos pelo vendedor."

Este aviso deve constar:
- No momento da oferta
- Antes da finalização do pagamento
- Preferencialmente na página de checkout
- Nos termos de compra
- Nas comunicações automáticas relacionadas à transação

O não cumprimento pode gerar penalizações e até bloqueio da conta.

EXEMPLO DE RESPOSTA:
-------------------
{
  "id": "9c29870c-9f69-4bb6-90d3-2dce9453bb45",
  "qr_code": "00020101021226770014BR.GOV.BCB.PIX2555api...",
  "status": "created",
  "value": 35,
  "webhook_url": "http://teste.com",
  "qr_code_base64": "data:image/png;base64,iVBORw0KGgoAA.....",
  "webhook": null,
  "split_rules": [],
  "end_to_end_id": null,
  "payer_name": null,
  "payer_national_registration": null
}

DESCRIÇÃO DOS CAMPOS:
---------------------
Campo: id
Tipo: string
Descrição: Identificador único da transação gerada. Salve para consultar o status.

Campo: qr_code
Tipo: string
Descrição: Código PIX completo no padrão EMV para ser copiado e pago manualmente.

Campo: status
Tipo: string
Descrição: Status atual da transação (created, paid ou expired).

Campo: value
Tipo: integer
Descrição: Valor da cobrança em centavos de reais.

Campo: webhook_url
Tipo: string
Descrição: URL informada para receber notificações de pagamento.

Campo: qr_code_base64
Tipo: string
Descrição: Imagem do QR Code no formato base64, ideal para exibição.

Campo: webhook
Tipo: string/null
Descrição: Retorno interno do processamento da notificação enviada, se houver.

Campo: split_rules
Tipo: array
Descrição: Lista com as regras de divisão de valores (caso existam splits configurados).

Campo: end_to_end_id
Tipo: string/null
Descrição: Código identificador do PIX gerado pelo Banco Central (aparece após o pagamento).

Campo: payer_name
Tipo: string/null
Descrição: Nome do pagador, retornado após o pagamento.

Campo: payer_national_registration
Tipo: string/null
Descrição: CPF ou CNPJ do pagador, retornado após o pagamento.

WEBHOOK DE RETORNO:
-------------------
Ao adicionar o campo webhook_url na criação do QR Code PIX:
- Quando o status for alterado e caso falhe a tentativa, tentaremos enviar 3x
- Caso as 3 tentativas falhem, via painel administrativo será possível retomar os envios
- É possível adicionar um header customizado que será enviado em todos os webhooks
- Esta configuração está disponível no menu de configurações do painel
- NÃO recomendamos a prática de scrap - use os webhooks para receber alterações de status

ERROS DE LIMITE E VALIDAÇÃO:
----------------------------
1. Valor acima do limite permitido: Quando o valor ultrapassa o limite máximo configurado na conta
2. Valor do split maior que o valor total: Se o valor do split for maior que o valor total da transação
3. Split + taxa maior que o valor total: Quando a soma do split com a taxa for maior que o valor total
4. Conta de split não encontrada: Caso o account_id informado não corresponda a uma conta válida
5. Valor total dos splits excede o valor da transação: Se a soma dos splits for maior que o valor total
6. Splits do token inválidos: Validação similar para splits vindos de token

HEADER PARAMETERS:
------------------
Authorization: string (Required)
- Formato: Bearer TOKEN

Accept: string (Required)
- application/json

Content-Type: string (Required)
- application/json

BODY PARAMETERS:
----------------
value: number (Required)
- Valor em centavos (mínimo 50 centavos)

webhook_url: string (Optional)
- URL para receber informações de pagamento ou estorno

split_rules: array (Optional)
- Para realizar SPLIT para várias contas cadastradas na PUSHINPAY
- Formato: { "value": 50, "account_id": "9C3XXXXX3A043" }

RESPONSE CODES:
---------------
200: Object - ok
400: Object - Bad Request (Composição do request inválido)
401: Object - Unauthorized (Chave TOKEN inválida)
403: Object - Forbidden (Apenas administradores)
404: Object - Not Found (Pedido não existe)
405: Object - Method Not Allowed (Método não permitido)
406: Object - Not Acceptable (Formato JSON inválido)
410: Object - Gone (Essa requisição não existe mais)
418: Object - I'm a teapot
429: Object - Too Many Requests (Muitas requisições em curto espaço de tempo)
500: Object - Internal Server Error (Favor tente mais tarde)
503: Object - Service Unavailable (Estamos temporariamente inativos)

EXEMPLO DE REQUISIÇÃO JAVA:
---------------------------
OkHttpClient client = new OkHttpClient().newBuilder().build();
MediaType mediaType = MediaType.parse("application/json");
RequestBody body = RequestBody.create(mediaType, "{
  \"value\": 51,
  \"webhook_url\": \"https://seu-site.com\",
  \"split_rules\": []
}");
Request request = new Request.Builder()
  .url("https://api.pushinpay.com.br/api/pix/cashIn")
  .method("POST", body)
  .addHeader("Authorization", "Bearer")
  .addHeader("Accept", "application/json")
  .addHeader("Content-Type", "application/json")
  .build();
Response response = client.newCall(request).execute();

CONSULTAR PIX
=============

Endpoint: GET /api/transactions/{ID}
Base URL Produção: https://api.pushinpay.com.br
Base URL Sandbox: https://api-sandbox.pushinpay.com.br

DESCRIÇÃO:
Este endpoint consulta o STATUS de uma transação PIX.

PONTOS DE ATENÇÃO:
------------------
1. Recomendamos fazer consulta apenas quando o cliente FINAL identifique por alguma ação que foi pago
2. Consultas diretas são autorizadas a cada 1 minuto
3. Caso sejam feitas requisições abaixo desse tempo, sua conta poderá ser bloqueada
4. O retorno do endpoint é igual ao de criar PIX

HEADER PARAMETERS:
------------------
Authorization: string (Required)
- Formato: Bearer TOKEN

Accept: string (Required)
- application/json

Content-Type: string (Required)
- application/json

PATH PARAMETERS:
----------------
ID: string (Required)
- Identificador único da transação

RESPONSE CODES:
---------------
200: Object - Ok
404: Object - Se não encontrado, retorna null

EXEMPLO DE REQUISIÇÃO JAVA:
---------------------------
OkHttpClient client = new OkHttpClient().newBuilder().build();
MediaType mediaType = MediaType.parse("application/json");
RequestBody body = RequestBody.create(mediaType, "");
Request request = new Request.Builder()
  .url("https://api.pushinpay.com.br/api/transactions/{ID}")
  .method("GET", body)
  .addHeader("Authorization", "Bearer")
  .addHeader("Accept", "application/json")
  .addHeader("Content-Type", "application/json")
  .build();
Response response = client.newCall(request).execute();

OBSERVAÇÕES IMPORTANTES:
========================
- Sempre trabalhar com valores em centavos
- Valor mínimo de 50 centavos
- Respeitar limite de consultas (1 por minuto)
- Usar webhooks ao invés de scraping
- Incluir aviso obrigatório sobre papel da PushinPay
- Manter conta aprovada e dentro dos limites

CORREÇÕES IMPLEMENTADAS:
========================
1. ENDPOINT DE CONSULTA CORRIGIDO:
   - Antes: GET /api/pix/{id} (INCORRETO)
   - Agora: GET /api/transactions/{ID} (CORRETO conforme documentação oficial)

2. TRATAMENTO DE UNIDADES MONETÁRIAS MELHORADO:
   - Implementadas funções utilitárias CurrencyUtils para conversão explícita
   - PushinPay: sempre trabalha com centavos
   - Oasyfy: sempre trabalha com reais
   - Heurística melhorada para detectar se valor já está em centavos (valores > 1000)

3. FUNÇÕES UTILITÁRIAS ADICIONADAS:
   - CurrencyUtils.toCents(): converte para centavos
   - CurrencyUtils.toReais(): converte para reais
   - CurrencyUtils.isLikelyInCents(): detecta se valor provavelmente está em centavos

4. COMPATIBILIDADE MANTIDA:
   - Sistema continua funcionando com valores existentes
   - Logs melhorados para rastreamento de conversões
   - Validações aprimoradas para evitar erros de conversão